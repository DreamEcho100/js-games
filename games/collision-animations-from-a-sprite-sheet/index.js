import I from"../../libs/core/dom.js";import{adjustCanvas as P}from"../../libs/dom.js";import{scale2dSizeToFit as k}from"../../libs/math.js";import{generateSpriteAnimationStates as M}from"../../libs/sprite.js";import"../../libs/class-names.js";import"../../libs/cleanup.js";const H=await I({assetsInfo:[{type:"image",src:import.meta.resolve("./assets/images/boom.png",new URL(import.meta.url))},{type:"audio",src:import.meta.resolve("./assets/audios/Magic SFX Preview Pack/Fire impact 1.wav",new URL(import.meta.url))},{type:"audio",src:import.meta.resolve("./assets/audios/Magic SFX Preview Pack/Healing Full.wav",new URL(import.meta.url))},{type:"audio",src:import.meta.resolve("./assets/audios/Magic SFX Preview Pack/Ice attack 2.wav",new URL(import.meta.url))},{type:"audio",src:import.meta.resolve("./assets/audios/Magic SFX Preview Pack/Misc 02.wav",new URL(import.meta.url))},{type:"audio",src:import.meta.resolve("./assets/audios/Magic SFX Preview Pack/Wind effects 5.wav",new URL(import.meta.url))}],cb:({assets:v,cleanUpManager:n,createLayout:f})=>{const[h,...d]=v,S=h.naturalWidth,x=h.naturalHeight,l=S/5,u=x,F=M([{name:"default",frames:5}],{width:l,height:u});let a={width:500,height:700,x:0,y:0};f(`<small class='block text-center'><em>In Progress</em></small><canvas
			id="vanillaJavascriptSpriteAnimationTechniques"
			width="${a.width}"
			height="${a.height}"
			class="border border-solid border-gray-300 dark:border-gray-700 max-w-full mx-auto"
		></canvas>`);const s=document.getElementById("vanillaJavascriptSpriteAnimationTechniques");if(!s)throw new Error("Couldn't find the canvas!");const i=s.getContext("2d");if(!i)throw new Error("Couldn't get the canvas context!");const y=P({canvas:s,ctx:i,onUpdateCanvasSize:e=>{a=e}});n.register(y);let g=0;class X{constructor(t){this.x=t.x,this.y=t.y;const o=k({containerWidth:t.sprite.renderBaseWidth,sourceWidth:t.sprite.width,sourceHeight:t.sprite.height});this.sprite={animationStates:t.sprite.animationStates,currentAnimationState:t.sprite.currentAnimationState,img:t.sprite.img,currentFrameX:0,currentFrameY:0,width:t.sprite.width,height:t.sprite.height},this.width=o.width,this.height=o.height,this.speedModifier=8,this.angle=Math.random()*Math.PI*2,this.sfx=t.sfx}draw(){i.save(),i.translate(this.x+this.width*.5,this.y+this.height*.5),i.rotate(this.angle),i.drawImage(this.sprite.img,this.sprite.width*this.sprite.currentFrameX,this.sprite.height*this.sprite.currentFrameY,this.sprite.width,this.sprite.height,0-this.width*.5,0-this.height*.5,this.width,this.height),i.restore()}update(){const t=this.sprite.animationStates[this.sprite.currentAnimationState];this.sprite.currentFrameX===0&&this.sfx.play(),g%this.speedModifier===0&&(this.sprite.currentFrameX=this.sprite.currentFrameX>=t.locations.length-1?0:this.sprite.currentFrameX+1)}}const m=new Set;function p(e){i.fillStyle="white";const o=e.pageX-a.x,A=e.pageY-a.y,r=new X({x:o,y:A,sprite:{animationStates:F,currentAnimationState:"default",img:h,renderBaseWidth:100,width:l,height:u},sfx:d[Math.floor(Math.random()*d.length)]});m.add(r),r.x-=r.width*.5,r.y-=r.height*.5}n.registerEventListener({elem:s,type:"mousemove",listener:p}),n.registerEventListener({elem:s,type:"click",listener:p});let c;function w(){i.clearRect(0,0,a.width,a.height),m.forEach(e=>{e&&(e.update(),e.draw(),e.sprite.currentFrameX>=e.sprite.animationStates[e.sprite.currentAnimationState].locations.length-1&&m.delete(e))}),g++,c=requestAnimationFrame(w)}n.register(()=>{c&&cancelAnimationFrame(c)}),w()}});export{H as default};
