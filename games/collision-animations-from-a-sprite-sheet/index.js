import P from"../../libs/core/dom.js";import{adjustCanvas as M}from"../../libs/dom.js";import{scale2dSizeToFit as W}from"../../libs/math.js";import{generateSpriteAnimationStates as k}from"../../libs/sprite.js";import{resolveBaseImportUrl as n}from"../../libs/urls.js";import"../../libs/class-names.js";import"../../libs/cleanup.js";const L=await P({assetsInfo:[{type:"image",src:import.meta.resolve("./assets/images/boom.png",new URL(import.meta.url))},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Fire impact 1.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Healing Full.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Ice attack 2.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Misc 02.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Wind effects 5.wav")}],cb:({assets:S,cleanUpManager:o,createLayout:v})=>{const[c,...g]=S,x=c.naturalWidth,F=c.naturalHeight,u=x/5,l=F,y=k([{name:"default",frames:5}],{width:u,height:l});let a={width:500,height:700,x:0,y:0};v(`<canvas
			id="vanillaJavascriptSpriteAnimationTechniques"
			width="${a.width}"
			height="${a.height}"
			class="border border-solid border-gray-300 dark:border-gray-700 max-w-full mx-auto"
		></canvas>`);const s=document.getElementById("vanillaJavascriptSpriteAnimationTechniques");if(!s)throw new Error("Couldn't find the canvas!");const i=s.getContext("2d");if(!i)throw new Error("Couldn't get the canvas context!");const X=M({canvas:s,ctx:i,onUpdateCanvasSize:e=>{a=e}});o.register(X);let p=0;class A{constructor(t){this.x=t.x,this.y=t.y;const h=W({containerWidth:t.sprite.renderBaseWidth,sourceWidth:t.sprite.width,sourceHeight:t.sprite.height});this.sprite={animationStates:t.sprite.animationStates,currentAnimationState:t.sprite.currentAnimationState,img:t.sprite.img,currentFrameX:0,currentFrameY:0,width:t.sprite.width,height:t.sprite.height},this.width=h.width,this.height=h.height,this.speedModifier=8,this.angle=Math.random()*Math.PI*2,this.sfx=t.sfx}draw(){i.save(),i.translate(this.x+this.width*.5,this.y+this.height*.5),i.rotate(this.angle),i.drawImage(this.sprite.img,this.sprite.width*this.sprite.currentFrameX,this.sprite.height*this.sprite.currentFrameY,this.sprite.width,this.sprite.height,0-this.width*.5,0-this.height*.5,this.width,this.height),i.restore()}update(){const t=this.sprite.animationStates[this.sprite.currentAnimationState];this.sprite.currentFrameX===0&&this.sfx.play(),p%this.speedModifier===0&&(this.sprite.currentFrameX=this.sprite.currentFrameX>=t.locations.length-1?0:this.sprite.currentFrameX+1)}}const m=new Set;function w(e){i.fillStyle="white";const h=e.pageX-a.x,I=e.pageY-a.y,r=new A({x:h,y:I,sprite:{animationStates:y,currentAnimationState:"default",img:c,renderBaseWidth:100,width:u,height:l},sfx:g[Math.floor(Math.random()*g.length)]});m.add(r),r.x-=r.width*.5,r.y-=r.height*.5}o.registerEventListener({elem:s,type:"mousemove",listener:w}),o.registerEventListener({elem:s,type:"click",listener:w});let d;function f(){i.clearRect(0,0,a.width,a.height),m.forEach(e=>{e&&(e.update(),e.draw(),e.sprite.currentFrameX>=e.sprite.animationStates[e.sprite.currentAnimationState].locations.length-1&&m.delete(e))}),p++,d=requestAnimationFrame(f)}o.register(()=>{d&&cancelAnimationFrame(d)}),f()}});export{L as default};
