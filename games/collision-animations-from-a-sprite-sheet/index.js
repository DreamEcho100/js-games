import M from"../../libs/core/dom.js";import{adjustCanvas as k}from"../../libs/dom.js";import{scale2dSizeToFit as E}from"../../libs/math.js";import{generateSpriteAnimationStates as W}from"../../libs/sprite.js";import{resolveBaseImportUrl as n}from"../../libs/urls.js";import"../../libs/class-names.js";import"../../libs/cleanup.js";const L=await M({assetsInfo:[{type:"image",src:import.meta.resolve("./assets/images/boom.png",new URL(import.meta.url))},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Fire impact 1.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Healing Full.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Ice attack 2.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Misc 02.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Wind effects 5.wav")}],cb:({appId:x,assets:F,cleanUpManager:h,createLayout:X})=>{const g=`${x}-canvas`,[d,...u]=F,w=5,f=d.naturalWidth/w,p=d.naturalHeight,I=W([{name:"default",frames:w}],{width:f,height:p}),i={render:{width:500,height:700},dom:{x:0,y:0}};X(`<canvas
			id="${g}"
			width="${i.render.width}"
			height="${i.render.height}"
			class="border border-solid border-gray-300 dark:border-gray-700 mx-auto max-w-full w-5xl"
		></canvas>`);const s=document.getElementById(g);if(!s)throw new Error("Couldn't find the canvas!");const r=s.getContext("2d");if(!r)throw new Error("Couldn't get the canvas context!");const P=k({canvas:s,ctx:r,onUpdateCanvasSize:t=>{i.dom=t,i.render.width=t.width,i.render.height=t.height}});h.register(P);let S=0;class A{constructor(e){this.x=e.x,this.y=e.y;const o=E({containerWidth:e.sprite.renderBaseWidth,containerHeight:e.sprite.renderBaseHeight,sourceWidth:e.sprite.width,sourceHeight:e.sprite.height});this.sprite={animationStates:e.sprite.animationStates,currentAnimationState:e.sprite.currentAnimationState,img:e.sprite.img,currentFrameX:0,currentFrameY:0,width:e.sprite.width,height:e.sprite.height},this.width=o.width,this.height=o.height,this.speedModifier=8,this.angle=Math.random()*Math.PI*2,this.sfx=e.sfx}draw(){r.save(),r.translate(this.x+this.width*.5,this.y+this.height*.5),r.rotate(this.angle),r.drawImage(this.sprite.img,this.sprite.width*this.sprite.currentFrameX,this.sprite.height*this.sprite.currentFrameY,this.sprite.width,this.sprite.height,0-this.width*.5,0-this.height*.5,this.width,this.height),r.restore()}update(){const e=this.sprite.animationStates[this.sprite.currentAnimationState];this.sprite.currentFrameX===0&&this.sfx.play(),S%this.speedModifier===0&&(this.sprite.currentFrameX=this.sprite.currentFrameX>=e.size-1?0:this.sprite.currentFrameX+1)}}const c=new Set;function v(t){r.fillStyle="white";const o=t.pageX-i.dom.x,C=t.pageY-i.dom.y,a=new A({x:o,y:C,sprite:{animationStates:I,currentAnimationState:"default",img:d,renderBaseWidth:100,width:f,height:p},sfx:u[Math.floor(Math.random()*u.length)]});c.add(a),a.x-=a.width*.5,a.y-=a.height*.5}h.registerEventListener({elem:s,type:"mousemove",listener:v}),h.registerEventListener({elem:s,type:"click",listener:v});let m;setTimeout(()=>{r.fillStyle="red",r.fillRect(0,0,i.render.width,i.render.height)},1e3);let l=0;function y(){r.clearRect(0,0,i.render.width,i.render.height),l=(l+1)%360,r.fillStyle=`hsl(${l}, 100%, 50%)`,r.fillRect(0,0,i.render.width,i.render.height),c.forEach(t=>{t&&(t.update(),t.draw(),t.sprite.currentFrameX>=t.sprite.animationStates[t.sprite.currentAnimationState].size-1&&c.delete(t))}),S++,m=requestAnimationFrame(y)}h.register(()=>{m&&cancelAnimationFrame(m)}),y()}});export{L as default};
