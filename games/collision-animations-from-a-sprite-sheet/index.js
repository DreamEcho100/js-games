import P from"../../libs/core/dom.js";import{adjustCanvas as I}from"../../libs/dom.js";import{scale2dSizeToFit as M}from"../../libs/math.js";import{generateSpriteAnimationStates as k}from"../../libs/sprite.js";import{resolveBaseImportUrl as n}from"../../libs/urls.js";import"../../libs/class-names.js";import"../../libs/cleanup.js";const Y=await P({assetsInfo:[{type:"image",src:import.meta.resolve("./assets/images/boom.png",new URL(import.meta.url))},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Fire impact 1.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Healing Full.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Ice attack 2.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Misc 02.wav")},{type:"audio",src:n("#assets/audios/Magic SFX Preview Pack/Wind effects 5.wav")}],cb:({assets:S,cleanUpManager:h,createLayout:x})=>{const[c,...g]=S,u=5,l=c.naturalWidth/u,p=c.naturalHeight,F=k([{name:"default",frames:u}],{width:l,height:p});let a={width:500,height:700,x:0,y:0};x(`<canvas
			id="vanillaJavascriptSpriteAnimationTechniques"
			width="${a.width}"
			height="${a.height}"
			class="border border-solid border-gray-300 dark:border-gray-700 max-w-full mx-auto"
		></canvas>`);const s=document.getElementById("vanillaJavascriptSpriteAnimationTechniques");if(!s)throw new Error("Couldn't find the canvas!");const i=s.getContext("2d");if(!i)throw new Error("Couldn't get the canvas context!");const y=I({canvas:s,ctx:i,onUpdateCanvasSize:e=>{a=e}});h.register(y);let w=0;class X{constructor(t){this.x=t.x,this.y=t.y;const o=M({containerWidth:t.sprite.renderBaseWidth,containerHeight:t.sprite.renderBaseHeight,sourceWidth:t.sprite.width,sourceHeight:t.sprite.height});this.sprite={animationStates:t.sprite.animationStates,currentAnimationState:t.sprite.currentAnimationState,img:t.sprite.img,currentFrameX:0,currentFrameY:0,width:t.sprite.width,height:t.sprite.height},this.width=o.width,this.height=o.height,this.speedModifier=8,this.angle=Math.random()*Math.PI*2,this.sfx=t.sfx}draw(){i.save(),i.translate(this.x+this.width*.5,this.y+this.height*.5),i.rotate(this.angle),i.drawImage(this.sprite.img,this.sprite.width*this.sprite.currentFrameX,this.sprite.height*this.sprite.currentFrameY,this.sprite.width,this.sprite.height,0-this.width*.5,0-this.height*.5,this.width,this.height),i.restore()}update(){const t=this.sprite.animationStates[this.sprite.currentAnimationState];this.sprite.currentFrameX===0&&this.sfx.play(),w%this.speedModifier===0&&(this.sprite.currentFrameX=this.sprite.currentFrameX>=t.size-1?0:this.sprite.currentFrameX+1)}}const d=new Set;function f(e){i.fillStyle="white";const o=e.pageX-a.x,A=e.pageY-a.y,r=new X({x:o,y:A,sprite:{animationStates:F,currentAnimationState:"default",img:c,renderBaseWidth:100,width:l,height:p},sfx:g[Math.floor(Math.random()*g.length)]});d.add(r),r.x-=r.width*.5,r.y-=r.height*.5}h.registerEventListener({elem:s,type:"mousemove",listener:f}),h.registerEventListener({elem:s,type:"click",listener:f});let m;function v(){i.clearRect(0,0,a.width,a.height),d.forEach(e=>{e&&(e.update(),e.draw(),e.sprite.currentFrameX>=e.sprite.animationStates[e.sprite.currentAnimationState].size-1&&d.delete(e))}),w++,m=requestAnimationFrame(v)}h.register(()=>{m&&cancelAnimationFrame(m)}),v()}});export{Y as default};
