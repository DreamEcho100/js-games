import{createScope as x,createSignal as p,createMemo as f,createEffect as y}from"./signals.js";import{tagsProxy as a}from"./dom.js";import{$toggle as m,$list as b}from"./dom-signal.js";function h(e){return a.header({className:"mb-4"},a.h1({className:"text-5xl text-center text-gray-600 font-thin mb-6"},"todos"),v(e))}function v({newTodoText:e,todos:l}){function r(i){i.trim()&&(l.update(o=>[...o,{id:Date.now(),text:i.trim(),completed:!1,editing:!1}]),e.set(""))}function c(i){l.update(o=>o.map(n=>({...n,completed:i})))}return a.div({className:"relative"},a.form({className:"flex",onsubmit:i=>{i.preventDefault(),r(e())}},a.input({className:"w-full shadow-sm px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg text-gray-700",placeholder:"What needs to be done?",value:()=>e(),oninput:i=>e.set(i.target.value)})),m(()=>l().length>0,()=>a.button({className:"text-gray-400 hover:text-gray-700 transition-colors",onclick:()=>{const i=l().every(o=>o.completed);c(!i)},ariaLabel:()=>l().every(o=>o.completed)?"Mark all as incomplete":"Mark all as complete"},"▼ Mark")))}function N({todo:e,todos:l}){function r(n){l.update(s=>s.map(t=>t.id===n?{...t,completed:!t.completed}:t))}function c(n){l.update(s=>s.map(t=>t.id===n?{...t,editing:!0}:{...t,editing:!1}))}function i(n){l.update(s=>s.filter(t=>t.id!==n))}function o(n,s){if(!s.trim()){i(n);return}l.update(t=>t.map(d=>d.id===n?{...d,text:s.trim(),editing:!1}:d))}return a.li({className:"group flex items-center border-b py-3 px-2 transition-all hover:bg-gray-50"},m(()=>!e.editing,()=>[a.div({className:"flex items-center flex-1"},a.input({type:"checkbox",className:"mr-3 h-5 w-5 rounded border-gray-300 text-blue-500 focus:ring-blue-500",checked:()=>!!e.completed,onchange:()=>r(e.id),ariaLabel:()=>`Mark "${e.text}" as ${e.completed?"incomplete":"complete"}`}),a.span({className:()=>`flex-1 text-lg ${e.completed?"line-through text-gray-400":"text-gray-700"}`,ondblclick:()=>c(e.id)},e.text)),a.button({className:"opacity-90 group-hover:opacity-100 text-red-500 hover:text-red-700 px-2 transition-opacity",onclick:()=>i(e.id),ariaLabel:`Delete ${e.text}`},"×")]),m(()=>e.editing,()=>a.form({className:"flex-1",onsubmit:n=>{n.preventDefault();const s=n.target.querySelector("input");o(e.id,s?.value??"")},onkeydown:n=>{n.key==="Escape"&&l.update(s=>s.map(t=>t.id===e.id?{...t,editing:!1}:t))}},a.input({className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:e.text,onblur:n=>o(e.id,n.target.value),ref:n=>setTimeout(()=>{n.focus(),n.selectionStart=n.selectionEnd=n.value.length},0)}))))}function k({todos:e,filteredTodos:l}){return a.section({className:"mb-6"},m(()=>e().length>0,()=>a.ul({className:"divide-y divide-gray-200 border-t border-b"},b(l,r=>r.id,r=>N({todo:r,todos:e})))),m(()=>e().length===0,()=>a.div({className:"py-8 text-center text-gray-500"},a.p({},"No todos yet. Add one above!"),a.div({className:"text-5xl my-4 opacity-25"},"📝"))))}function w({todos:e,remainingCount:l,hasCompleted:r,filter:c}){function i(){e.update(o=>o.filter(n=>!n.completed))}return m(()=>e().length>0,()=>a.footer({className:"flex flex-wrap justify-between items-center text-sm text-gray-500 py-2 px-2"},a.span({className:"mr-4 my-1"},`${l.peek()} item${l.peek()!==1?"s":""} left`),a.div({className:"flex space-x-1 my-1"},g({filterName:"all",label:"All",filter:c}),g({filterName:"active",label:"Active",filter:c}),g({filterName:"completed",label:"Completed",filter:c})),m(r,()=>a.button({className:"my-1 text-gray-500 hover:text-gray-700 hover:underline transition-colors",onclick:i},"Clear completed"))))}function g({filterName:e,label:l,filter:r}){return a.button({className:()=>`px-3 py-1 rounded-md ${r()===e?"bg-blue-100 text-blue-700":"hover:bg-gray-100"}`,onclick:()=>r.set(e)},l)}function C(){return a.footer({className:"mt-8 text-center text-sm text-gray-500"},a.p({},"Double-click to edit a todo"),a.p({className:"mt-2"},"Created using signals.js and tailwindcss"))}function T(){return x(()=>{const e=p(n()||[]),l=p("all"),r=p(""),c=f(()=>{const t=l(),d=e();switch(t){case"active":return d.filter(u=>!u.completed);case"completed":return d.filter(u=>u.completed);default:return d}}),i=f(()=>e().filter(t=>!t.completed).length),o=f(()=>e().some(t=>t.completed));y(()=>{const t=e();localStorage.setItem("todos",JSON.stringify(t))});function n(){const t=localStorage.getItem("todos");return t?JSON.parse(t):[]}return a.div({className:"max-w-lg mx-auto my-8 bg-white rounded-lg shadow-xl p-6 w-80 max-w-full"},h({newTodoText:r,todos:e}),k({todos:e,filteredTodos:c}),w({todos:e,remainingCount:i,hasCompleted:o,filter:l}),C())}).result}function I(e){document.addEventListener("DOMContentLoaded",()=>{const l=T();(e??document.body).appendChild(l);const r=document.createElement("link");r.rel="stylesheet",r.href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css",document.head.appendChild(r);const c=document.createElement("link");c.rel="stylesheet",c.href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap",document.head.appendChild(c),document.body.classList.add("bg-gray-100","text-gray-800","min-h-screen","py-8","font-sans"),document.body.style.fontFamily="'Inter', sans-serif"})}export{I as initializeTodoApp};
