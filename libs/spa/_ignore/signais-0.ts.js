let k=0,u=0,o=null;const c=new Set;let l=!1;const m=Symbol("signal");function p(e,t){if(Object.is(e,t))return!0;if(e===null||t===null||typeof e!="object"||typeof t!="object")return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!p(e[n],t[n]))return!1;return!0}if(e.constructor!==t.constructor)return!1;if(e instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp)return e.toString()===t.toString();const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!p(e[n],t[n]))return!1;return!0}function y(e,t){return{id:k++,version:0,value:e,compute:void 0,cleanup:void 0,error:void 0,dirty:!1,onDirty:void 0,sources:new WeakMap,observers:new Set,name:t}}function g(e){o&&(o.sources.set(e,e.version),e.observers.add(o))}function v(){l||c.size<0||(l=!0,queueMicrotask(()=>{l=!1;const e=Array.from(c);c.clear();for(const t of e)a(t)}))}function d(e){for(const t of e.observers)t.dirty=!0,t.onDirty&&(u>0?c.add(t):v())}function S(e,t){const r=y(e,t?.name),s=t?.equals??p,n=Object.assign(()=>(g(r),r.value),{set:f=>{s(r.value,f)||(r.value=f,r.version++,d(r))},update:f=>n.set(f(r.value)),peek:()=>r.value,[m]:r});return n}const i=[];function h(e){const t=Array.from(e.observers);for(const r of t)r.sources.delete(e);e.sources=new WeakMap}function a(e){if(!e.compute)return;if(i.includes(e)){const r=i.slice(i.indexOf(e)).map(n=>n.name||`Node_${n.id}`).join(" â†’ "),s=new Error(`Cycle detected in reactive graph: ${r}`);console.error(s),e.error=s;return}i.push(e),h(e);const t=o;o=e;try{e.cleanup?.();const r=e.compute();e.onDirty?e.onDirty():(e.value=r,e.version++,d(e)),e.dirty=!1,e.error=void 0}catch(r){e.error=r,console.error(`Error in ${e.name?e.name:"reactive computation"}:`,r)}finally{i.pop(),o=t}}function b(e,t){const r=y(e,t?.name);return r.compute=e,r.onDirty=()=>{u>0?c.add(r):v()},a(r),()=>{r.cleanup?.(),r.cleanup=void 0,h(r),c.delete(r)}}function O(e){if(!e.compute)return!1;let t=e.dirty;return t||(t=!!e.dirty),t?(a(e),!0):!1}function A(e,t){const r=y(void 0,t?.name);r.compute=e;const s=()=>(g(r),O(r),r.value);return a(r),s[m]=r,s}function j(e){u++;try{return e()}finally{u--,u===0&&v()}}export{m as SIGNAL,j as batchSignals,b as createEffect,A as createMemo,S as createSignal};
