import{onScopeCleanup as h,createEffect as m,getScopeId as w}from"./signals.js";function N(t,o,r){if(typeof t=="function"){m(()=>{const e=t();if(typeof e=="object"&&e!==null){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const s=e[n];typeof s=="function"?m(()=>{const c=s();r(n,c)}):r(n,s)}return}o(e)});return}if(typeof t=="object"&&t!==null){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];typeof n=="function"?m(()=>{const s=n();r(e,s)}):r(e,n)}return}o(t)}function p(t,o){if(typeof t=="function"){m(()=>{const r=t();o(r)});return}o(t)}function L(t,o,r){switch(o){case"style":return N(r,e=>{if(e==null){t.style.cssText="";return}t.style.cssText=e},(e,n)=>{if(n==null){t.style[e]="";return}t.style[e]=n}),!0;case"className":return p(r,e=>{if(e==null){t.className="";return}t.className=e}),!0;case"value":return p(r,e=>{if(e==null){t.value="";return}t.value=e}),!0;case"dataSet":return N(r,e=>{if(e==null){t.dataset={};return}t.dataset=e},(e,n)=>{if(n==null){t.dataset[e]="";return}t.dataset[e]=n}),!0;case"ariaSet":{let e=new Set;return N(r,n=>{if(n==null){if(e.size>0)for(const s of e)t[s]="";e.clear();return}for(const s in n){const c=s,i=n[s];if(i==null){t[s]="";return}e.add(c),t[s]=i}},(n,s)=>{if(s==null){t[n]="";return}t[n]=s}),h(()=>{e.clear()}),!0}case"dangerouslySetInnerHTML":return p(r,e=>{if(e==null){t.innerHTML="";return}t.innerHTML=e}),!0;case"ref":{const e=r;return typeof e=="function"?e(t):e&&typeof e=="object"&&"current"in e&&(e.current=t),!0}}if(o.startsWith("on")){const e=o.slice(2).toLowerCase();let n=r,s,c;return Array.isArray(r)?(n=r[0],typeof r[1]=="boolean"?(s=r[1],c=r[1]):typeof r[1]=="object"&&(s=r[1].onAdd,c=r[1].onRemove)):n=r,t.addEventListener(e,n,s),h(()=>{t.removeEventListener(e,n,c)}),!0}return!1}function M(t,o,r){return p(r,e=>{if(typeof e=="boolean"){e?t.setAttribute(o,""):t.removeAttribute(o);return}t.setAttribute(o,e)}),!0}function j(t,o,r,e){p(e,n=>{if(typeof n=="boolean"){n?o.setAttributeNS(t,r,""):o.removeAttributeNS(t,r);return}o.setAttributeNS(t,r,n)})}function g(t,o=0){for(const r of t.children)if(r instanceof Node)t.nodeKey&&(r.dataset.trackId=String(t.nodeKey)),t.onNormalize?.(r,o++),t.fragment.appendChild(r);else if(Array.isArray(r))o=g(t,o);else{const e=document.createTextNode(r==null?"":String(r));t.onNormalize?.(e,o++),t.fragment.appendChild(e)}return o}function K(t,o,r){const e=document.createComment(`scope-${w()}list`);let n=new Map,s=!1;return m(()=>{const c=new Map,i=t(),u=Math.max(i.length,n.size);queueMicrotask(()=>{if(s)return;let a=e;for(let f=0;f<u;f++){const d=i[f],l=o(d,f,i),A=n.get(l);if(f<i.length&&A&&A.value===d){const y=document.createDocumentFragment();g({children:A.elems,fragment:y,nodeKey:l}),a.parentNode?.insertBefore(y,a),c.set(l,A)}else if(f<i.length){const y=r(d,f,i),b=Array.isArray(y)?y:[y],S=new Array(b.length),T=document.createDocumentFragment();g({children:b,onNormalize:(z,E)=>{S[E]=z},fragment:T,nodeKey:l}),b.length=0,a.parentNode?.insertBefore(T,a),c.set(l,{value:d,elems:S})}a=c.get(l)?.elems[0]??a}for(const[f,d]of n)if(!c.has(f))for(const l of d.elems)l.remove();n=c})}),h(()=>{s=!0;for(const{elems:c}of n.values())for(const i of c)i.remove();n.clear()}),e}function _(t,o){const r=document.createComment(`scope-${w()}visible`);let e=[],n=!1;return m(()=>{const s=t();queueMicrotask(()=>{if(!n){for(const c of e)c.remove();if(e=[],s){const c=o(),i=Array.isArray(c)?c:[c],u=document.createDocumentFragment();g({children:i,onNormalize:(a,f)=>{e[f]=a},fragment:u}),i.length=0,r.parentNode?.insertBefore(u,r)}}})}),h(()=>{n=!0;for(const s of e)s.remove();e=[]}),r}function $(t,o){const r=document.createComment(`scope-${w()}switch`);let e=[],n,s=!1;return m(()=>{const c=t(),i=o[c];n!==c&&queueMicrotask(()=>{if(!s){n=c;for(const u of e)u.remove();if(e=[],i){const u=i(),a=Array.isArray(u)?u:[u],f=document.createDocumentFragment();g({children:a,onNormalize:(d,l)=>{e[l]=d},fragment:f}),a.length=0,r.parentNode?.insertBefore(f,r)}}})}),h(()=>{s=!0;for(const c of e)c.remove();e=[]}),r}export{K as $list,$ as $switch,_ as $toggle,L as setGeneralTagAttribute,M as setTagAttribute,j as setTagAttributeNS};
