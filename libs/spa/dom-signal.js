import{onScopeCleanup as h,createEffect as m,getScopeId as w}from"./signals.js";function N(e,o,r){if(typeof e=="function"){m(()=>{const t=e();if(typeof t=="object"&&t!==null){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];typeof s=="function"?m(()=>{const c=s();r(n,c)}):r(n,s)}return}o(t)});return}if(typeof e=="object"&&e!==null){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];typeof n=="function"?m(()=>{const s=n();r(t,s)}):r(t,n)}return}o(e)}function p(e,o){if(typeof e=="function"){m(()=>{const r=e();o(r)});return}o(e)}function L(e,o,r){switch(o){case"style":return N(r,t=>{if(t==null){e.style.cssText="";return}e.style.cssText=t},(t,n)=>{if(n==null){e.style[t]="";return}e.style[t]=n}),!0;case"className":return p(r,t=>{if(t==null){e.className="";return}e.className=t}),!0;case"value":return p(r,t=>{if(t==null){e.value="";return}e.value=t}),!0;case"dataSet":return N(r,t=>{if(t==null){e.dataset={};return}e.dataset=t},(t,n)=>{if(n==null){e.dataset[t]="";return}e.dataset[t]=n}),!0;case"ariaSet":{let t=new Set;return N(r,n=>{if(n==null){if(t.size>0)for(const s of t)e[s]="";t.clear();return}for(const s in n){const c=s,i=n[s];if(i==null){e[s]="";return}t.add(c),e[s]=i}},(n,s)=>{if(s==null){e[n]="";return}e[n]=s}),h(()=>{t.clear()}),!0}case"dangerouslySetInnerHTML":return p(r,t=>{if(t==null){e.innerHTML="";return}e.innerHTML=t}),!0;case"ref":{const t=r;document.startViewTransition(()=>(typeof t=="function"?t(e):t&&typeof t=="object"&&"current"in t&&(t.current=e),!0))}}if(o.startsWith("on")){const t=o.slice(2).toLowerCase();let n=r,s,c;return Array.isArray(r)?(n=r[0],typeof r[1]=="boolean"?(s=r[1],c=r[1]):typeof r[1]=="object"&&(s=r[1].onAdd,c=r[1].onRemove)):n=r,e.addEventListener(t,n,s),h(()=>{e.removeEventListener(t,n,c)}),!0}return!1}function M(e,o,r){return p(r,t=>{if(typeof t=="boolean"){t?e.setAttribute(o,""):e.removeAttribute(o);return}e.setAttribute(o,t)}),!0}function j(e,o,r,t){p(t,n=>{if(typeof n=="boolean"){n?o.setAttributeNS(e,r,""):o.removeAttributeNS(e,r);return}o.setAttributeNS(e,r,n)})}function g(e,o=0){for(const r of e.children)if(r instanceof Node)e.nodeKey&&(r.dataset.trackId=String(e.nodeKey)),e.onNormalize?.(r,o++),e.fragment.appendChild(r);else if(Array.isArray(r))o=g(e,o);else{const t=document.createTextNode(r==null?"":String(r));e.onNormalize?.(t,o++),e.fragment.appendChild(t)}return o}function K(e,o,r){const t=document.createComment(`scope-${w()}list`);let n=new Map,s=!1;return m(()=>{const c=new Map,i=e(),u=Math.max(i.length,n.size);queueMicrotask(()=>{if(s)return;let a=t;for(let f=0;f<u;f++){const d=i[f],l=o(d,f,i),A=n.get(l);if(f<i.length&&A&&A.value===d){const y=document.createDocumentFragment();g({children:A.elems,fragment:y,nodeKey:l}),a.parentNode?.insertBefore(y,a),c.set(l,A)}else if(f<i.length){const y=r(d,f,i),b=Array.isArray(y)?y:[y],S=new Array(b.length),T=document.createDocumentFragment();g({children:b,onNormalize:(z,E)=>{S[E]=z},fragment:T,nodeKey:l}),b.length=0,a.parentNode?.insertBefore(T,a),c.set(l,{value:d,elems:S})}a=c.get(l)?.elems[0]??a}for(const[f,d]of n)if(!c.has(f))for(const l of d.elems)l.remove();n=c})}),h(()=>{s=!0;for(const{elems:c}of n.values())for(const i of c)i.remove();n.clear()}),t}function _(e,o){const r=document.createComment(`scope-${w()}visible`);let t=[],n=!1;return m(()=>{const s=e();queueMicrotask(()=>{if(!n){for(const c of t)c.remove();if(t=[],s){const c=o(),i=Array.isArray(c)?c:[c],u=document.createDocumentFragment();g({children:i,onNormalize:(a,f)=>{t[f]=a},fragment:u}),i.length=0,r.parentNode?.insertBefore(u,r)}}})}),h(()=>{n=!0;for(const s of t)s.remove();t=[]}),r}function $(e,o){const r=document.createComment(`scope-${w()}switch`);let t=[],n,s=!1;return m(()=>{const c=e(),i=o[c];n!==c&&queueMicrotask(()=>{if(!s){n=c;for(const u of t)u.remove();if(t=[],i){const u=i(),a=Array.isArray(u)?u:[u],f=document.createDocumentFragment();g({children:a,onNormalize:(d,l)=>{t[l]=d},fragment:f}),a.length=0,r.parentNode?.insertBefore(f,r)}}})}),h(()=>{s=!0;for(const c of t)c.remove();t=[]}),r}export{K as $list,$ as $switch,_ as $toggle,L as setGeneralTagAttribute,M as setTagAttribute,j as setTagAttributeNS};
