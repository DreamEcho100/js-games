import{roundToPrecision as s}from"./math.js";async function w(n){return new Promise(i=>{const o=new Image;o.onload=function(e){const t=e.target;if("naturalHeight"in t&&"naturalWidth"in t&&(t.naturalHeight+t.naturalWidth===0||t.width+t.height===0)){i([new Error("Image has no dimensions"),null]);return}i([null,o])},o.onerror=function(e){const t=e instanceof Error?e.message:typeof e=="string"?e:`Error loading as image: ${n}`;i([new Error(`Failed to load image at ${n}: ${t}`),null])},o.src=n})}async function b(n){return new Promise(i=>{const o=new Audio;o.preload="auto",o.onloadeddata=function(e){i([null,o])},o.onerror=function(e){const t=e instanceof Error?e.message:typeof e=="string"?e:`Error loading as audio: ${n}`;i([new Error(`Failed to load image at ${n}: ${t}`),null])},o.src=n})}async function z(n){const i=await Promise.all(n.map(async e=>{if(e.type==="image"){const[t,a]=await w(e.src);return t?[new Error(`Failed to preload ${e.src}: ${t.message}`),null]:[null,a]}else if(e.type==="audio"){const[t,a]=await b(e.src);return t?[new Error(`Failed to preload ${e.src}: ${t.message}`),null]:[null,a]}return[new Error("Unknown asset type"),null]})),o=new Array(i.length);for(let e=0;e<i.length;e++){const[t,a]=i[e];if(t)return[t,null];o[e]=a}return[null,o]}function E(n,i){const o=document.createElement("link");return o.rel="stylesheet",o.type="text/css",o.href=n,document.head.appendChild(o),i?.register(()=>{o.remove()}),o}function $({canvas:n,ctx:i,onUpdateCanvasSize:o,debounce:e=100}){let t=!1;const a=[],r={width:0,height:0,top:0,left:0,right:0,bottom:0,x:0,y:0},g=Math.random().toString(36).slice(2),c=document.createElement("style");c.id=`style-${g}`,document.head.appendChild(c),a.push(()=>{c.remove()}),n.setAttribute(`data-${g}`,"true");const p=()=>{t=!0;const d=window.devicePixelRatio||1,l=n.getBoundingClientRect();n.width=s(l.width*d,2),n.height=s(l.height*d,2),i.setTransform(1,0,0,1,0,0),i.scale(d,d),r.width=s(l.width,2),r.height=s(l.height,2),r.top=s(l.top,2),r.left=s(l.left,2),r.right=s(l.right,2),r.bottom=s(l.bottom,2),r.x=s(l.x,2),r.y=s(l.y,2),o(r)};p(),c.innerHTML=`
    		[data-${g}] {
    			width: ${r.width}px;
    			/* height: ${r.height}px; */
    			aspect-ratio: ${s(r.width/r.height,2)};
    		}
    	`;let u;a.push(()=>{u&&(clearTimeout(u),u=void 0)});const m=()=>{if(u&&clearTimeout(u),t){t=!1;return}u=setTimeout(p,e)},h=new ResizeObserver(m);a.push(()=>h.disconnect()),n.addEventListener("resize",m),a.push(()=>{n.removeEventListener("resize",m)});const f=n.computedStyleMap().get("box-sizing")?.value??getComputedStyle(n).boxSizing??n.style.boxSizing;h.observe(n,{box:f});const y=document.body.computedStyleMap().get("box-sizing")?.value??getComputedStyle(document.body).boxSizing??document.body.style.boxSizing;return h.observe(document.body,{box:y}),()=>{for(const d of a)d()}}export{$ as adjustCanvas,E as injectStylesheetLink,z as loadManyAssets,b as loadOneAudioElement,w as loadOneImageElement};
